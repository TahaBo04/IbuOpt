<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IbuOpt â€” Pareto Selector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: #f0f4f8;
      color: #1a2332;
      line-height: 1.6;
    }

    /* Hero Header */
    .hero {
      background: linear-gradient(135deg, #0f2b46 0%, #1a4a6e 40%, #2d7d9a 100%);
      color: #fff;
      padding: 52px 24px 44px;
      text-align: center;
    }
    .hero-badge {
      display: inline-block;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 999px;
      padding: 4px 14px;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 16px;
    }
    .hero h1 {
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      margin-bottom: 10px;
    }
    .hero h1 span { color: #5ec6d6; }
    .hero p {
      max-width: 660px;
      margin: 0 auto;
      font-size: 1.05rem;
      color: rgba(255,255,255,0.82);
      line-height: 1.7;
    }

    /* Container */
    .container {
      max-width: 1060px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* About strip */
    .about {
      background: #fff;
      border-bottom: 1px solid #e2e8f0;
      padding: 28px 24px;
    }
    .about-inner {
      max-width: 1060px;
      margin: 0 auto;
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
    }
    .about-item {
      flex: 1;
      min-width: 200px;
      text-align: center;
      padding: 8px 4px;
    }
    .about-icon { font-size: 1.6rem; margin-bottom: 6px; }
    .about-item h4 {
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: #1a4a6e;
      margin-bottom: 4px;
    }
    .about-item p {
      font-size: 0.82rem;
      color: #5a6a7a;
      line-height: 1.5;
    }

    /* Main content */
    .main { padding: 32px 0 48px; }

    /* Section titles */
    .section-title {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #1a4a6e;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #d0dbe6;
    }

    /* Two-column panels */
    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 28px;
    }
    @media (max-width: 700px) {
      .panels { grid-template-columns: 1fr; }
    }

    .panel {
      background: #fff;
      border-radius: 14px;
      padding: 22px 24px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .panel h3 {
      font-size: 0.95rem;
      font-weight: 600;
      color: #1a2332;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel h3 .icon {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    .icon-weights { background: #e8f4fd; }
    .icon-constraints { background: #fef3e2; }

    /* Slider rows */
    .slider-row {
      display: grid;
      grid-template-columns: 1fr 56px;
      gap: 10px;
      align-items: center;
      margin-bottom: 16px;
    }
    .slider-row:last-child { margin-bottom: 0; }
    .slider-label {
      font-size: 0.82rem;
      font-weight: 500;
      color: #3a4a5c;
      margin-bottom: 4px;
    }
    .slider-val {
      font-size: 0.92rem;
      font-weight: 600;
      color: #1a4a6e;
      text-align: center;
      background: #f0f4f8;
      border-radius: 8px;
      padding: 6px 0;
    }

    /* Custom range slider */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: #d0dbe6;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #1a4a6e;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #1a4a6e;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }

    /* Action bar */
    .action-bar {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 28px;
    }
    .btn-recommend {
      padding: 12px 32px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, #1a4a6e, #2d7d9a);
      color: #fff;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
    }
    .btn-recommend:hover { opacity: 0.9; }
    .btn-recommend:active { transform: scale(0.98); }
    .status-pill {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
      background: #e8f4fd;
      color: #1a4a6e;
    }
    .err {
      color: #c53030;
      font-size: 0.85rem;
      margin-top: 6px;
    }

    /* Result cards */
    .card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .card h3 {
      font-size: 0.95rem;
      font-weight: 600;
      color: #1a2332;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Best point metrics */
    .metrics {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }
    .metric {
      flex: 1;
      min-width: 110px;
      background: #f0f4f8;
      border-radius: 10px;
      padding: 12px 14px;
      text-align: center;
    }
    .metric-label {
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #5a6a7a;
      margin-bottom: 4px;
    }
    .metric-value {
      font-size: 1.15rem;
      font-weight: 700;
      color: #1a4a6e;
    }

    /* Operating variables */
    .op-vars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }
    .op-var {
      font-size: 0.85rem;
      color: #3a4a5c;
      padding: 8px 12px;
      background: #fafbfc;
      border-radius: 8px;
      border: 1px solid #eef2f6;
    }
    .op-var b { color: #1a2332; }

    /* Table */
    table { width: 100%; border-collapse: collapse; }
    th {
      padding: 10px 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #5a6a7a;
      background: #f7f9fb;
      border-bottom: 2px solid #e2e8f0;
      text-align: left;
    }
    td {
      padding: 10px 12px;
      font-size: 0.85rem;
      color: #3a4a5c;
      border-bottom: 1px solid #f0f2f5;
    }
    tbody tr:hover { background: #f7f9fb; }

    /* Footer */
    .footer {
      text-align: center;
      padding: 28px 20px;
      font-size: 0.78rem;
      color: #8a9ab0;
      border-top: 1px solid #e2e8f0;
    }
    .footer a { color: #1a4a6e; text-decoration: none; }
    .footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>

  <!-- Hero Header -->
  <header class="hero">
    <div class="hero-badge">EMI Process Club &middot; JNITI Competition</div>
    <h1>Ibu<span>Opt</span></h1>
    <p>A Pareto-based interactive decision engine that converts complex ibuprofen process trade-offs into actionable operating conditions based on your priorities.</p>
  </header>

  <!-- About strip -->
  <section class="about">
    <div class="about-inner">
      <div class="about-item">
        <div class="about-icon">&#9878;&#65039;</div>
        <h4>Multi-Objective</h4>
        <p>Balance yield, cost and time &mdash; not just one metric</p>
      </div>
      <div class="about-item">
        <div class="about-icon">&#128202;</div>
        <h4>Pareto Front</h4>
        <p>Only the best non-dominated trade-off solutions</p>
      </div>
      <div class="about-item">
        <div class="about-icon">&#128274;</div>
        <h4>Safety Constraints</h4>
        <p>Industrially feasible &amp; safe operating windows</p>
      </div>
      <div class="about-item">
        <div class="about-icon">&#127919;</div>
        <h4>Your Priorities</h4>
        <p>Weights let you decide what matters most</p>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="main">
    <div class="container">

      <div class="section-title">Choose your trade-off</div>

      <!-- Weights & Constraints side by side -->
      <div class="panels">
        <div class="panel">
          <h3><span class="icon icon-weights">&#9878;&#65039;</span> Weights</h3>
          <div class="slider-row">
            <div>
              <div class="slider-label">Yield weight</div>
              <input id="w_yield" type="range" min="0" max="100" value="55">
            </div>
            <div class="slider-val" id="w_yield_val">55</div>
          </div>
          <div class="slider-row">
            <div>
              <div class="slider-label">Cost weight</div>
              <input id="w_cost" type="range" min="0" max="100" value="30">
            </div>
            <div class="slider-val" id="w_cost_val">30</div>
          </div>
          <div class="slider-row">
            <div>
              <div class="slider-label">Time weight</div>
              <input id="w_time" type="range" min="0" max="100" value="15">
            </div>
            <div class="slider-val" id="w_time_val">15</div>
          </div>
        </div>

        <div class="panel">
          <h3><span class="icon icon-constraints">&#128295;</span> Constraints <span style="font-weight:400;font-size:0.8rem;color:#8a9ab0;margin-left:4px;">(optional)</span></h3>
          <div class="slider-row">
            <div>
              <div class="slider-label">Min Yield (%)</div>
              <input id="min_yield" type="range" min="60" max="95" value="85">
            </div>
            <div class="slider-val" id="min_yield_val">85</div>
          </div>
          <div class="slider-row">
            <div>
              <div class="slider-label">Max Cost index</div>
              <input id="max_cost" type="range" min="0.10" max="0.90" step="0.01" value="0.60">
            </div>
            <div class="slider-val" id="max_cost_val">0.60</div>
          </div>
          <div class="slider-row">
            <div>
              <div class="slider-label">Max Time (h)</div>
              <input id="max_time" type="range" min="1" max="6" step="0.1" value="4.0">
            </div>
            <div class="slider-val" id="max_time_val">4.0</div>
          </div>
        </div>
      </div>

      <!-- Action bar -->
      <div class="action-bar">
        <button class="btn-recommend" id="btn">Recommend</button>
        <span class="status-pill" id="status">Ready</span>
      </div>
      <div class="err" id="err"></div>

      <!-- Results -->
      <div class="card" id="bestCard" style="display:none;"></div>
      <div class="card" id="topCard" style="display:none;"></div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    IbuOpt &middot; Developed for the <strong>JNITI Competition</strong> &mdash; EMI Process Club
  </footer>

<script>
  const sliderIds = ["w_yield","w_cost","w_time","min_yield","max_cost","max_time"];
  sliderIds.forEach(id => {
    const el = document.getElementById(id);
    const out = document.getElementById(id + "_val");
    const update = () => {
      if (id === "max_time") out.textContent = Number(el.value).toFixed(1);
      else if (id === "max_cost") out.textContent = Number(el.value).toFixed(2);
      else out.textContent = el.value;
    };
    el.addEventListener("input", update);
    update();
  });

  function payload() {
    return {
      w_yield: Number(document.getElementById("w_yield").value) / 100,
      w_cost:  Number(document.getElementById("w_cost").value) / 100,
      w_time:  Number(document.getElementById("w_time").value) / 100,
      min_yield: Number(document.getElementById("min_yield").value),
      max_cost:  Number(document.getElementById("max_cost").value),
      max_time:  Number(document.getElementById("max_time").value),
      top_k: 10
    };
  }

  function fmt(x, d=2){ return Number(x).toFixed(d); }

  function renderBest(b) {
    const card = document.getElementById("bestCard");
    card.style.display = "block";
    card.innerHTML = '<h3>\u{1F3C6} Best Operating Point</h3>' +
      '<div class="metrics">' +
        '<div class="metric"><div class="metric-label">Yield</div><div class="metric-value">' + fmt(b.Yield_pct) + '%</div></div>' +
        '<div class="metric"><div class="metric-label">Cost</div><div class="metric-value">' + fmt(b.Cost_index,3) + '</div></div>' +
        '<div class="metric"><div class="metric-label">Time</div><div class="metric-value">' + fmt(b.Time_h) + ' h</div></div>' +
        '<div class="metric"><div class="metric-label">Score</div><div class="metric-value">' + fmt(b.Score,4) + '</div></div>' +
      '</div>' +
      '<div class="section-title" style="margin-top:0;">Operating Variables</div>' +
      '<div class="op-vars">' +
        '<div class="op-var"><b>T</b> ' + fmt(b.Temp_C) + ' \u00B0C</div>' +
        '<div class="op-var"><b>P</b> ' + fmt(b.Pressure_bar) + ' bar</div>' +
        '<div class="op-var"><b>Pd</b> ' + fmt(b.Conc_Pd,5) + '</div>' +
        '<div class="op-var"><b>S/R</b> ' + fmt(b.Solvent_to_reactant) + '</div>' +
        '<div class="op-var"><b>N</b> ' + fmt(b.N_rpm,0) + ' rpm</div>' +
        '<div class="op-var"><b>yCO</b> ' + fmt(b.yCO,2) + '</div>' +
        '<div class="op-var"><b>P_CO</b> ' + fmt(b.P_CO_bar) + ' bar</div>' +
      '</div>';
  }

  function renderTop(list) {
    const card = document.getElementById("topCard");
    card.style.display = "block";
    var rows = "";
    for (var i = 0; i < list.length; i++) {
      var r = list[i];
      rows += '<tr><td>' + fmt(r.Score,4) + '</td><td>' + fmt(r.Yield_pct) + '</td><td>' + fmt(r.Cost_index,3) + '</td><td>' + fmt(r.Time_h) + '</td><td>' + fmt(r.Temp_C,1) + '</td><td>' + fmt(r.Pressure_bar,1) + '</td></tr>';
    }
    card.innerHTML = '<h3>\u{1F4CB} Top Alternatives</h3>' +
      '<table>' +
        '<thead><tr><th>Score</th><th>Yield</th><th>Cost</th><th>Time</th><th>T (\u00B0C)</th><th>P (bar)</th></tr></thead>' +
        '<tbody>' + rows + '</tbody>' +
      '</table>';
  }

  document.getElementById("btn").addEventListener("click", async () => {
    document.getElementById("err").textContent = "";
    document.getElementById("status").textContent = "Running...";
    try {
      const res = await fetch("/api/recommend", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload())
      });
      const out = await res.json();
      if (!res.ok) throw new Error(out.error || "Request failed");
      renderBest(out.best);
      renderTop(out.top);
      document.getElementById("status").textContent = "Done";
    } catch (e) {
      document.getElementById("status").textContent = "Error";
      document.getElementById("err").textContent = e.message;
    }
  });
</script>
</body>
</html>
